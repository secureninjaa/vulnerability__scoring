#include<stdio.h>
#include<string.h>
#include<math.h>
// fn declaration of base
float AccessComplexity();
float Authentication();
float AccessVector();
float ConfidentialityImpact();
float IntegrityImpact();
float AvailabilityImpact();
void printbase();
// fn declaration of temporal
float Exploitability();
float RemediationLevel();
float ReportConfidence();
//fn declrn of environmental
float CollateralDamagePotential();
float TargetDistribution();
float ConfidentialityRequirement();
float IntegrityRequirement();
float AvailabilityRequirement();
struct base
{
	float Impact,Exploitability,BaseScore,CImp,IImp,AImp;
};
struct temporal
{
	float TemporalScore ,ReLe,ReCo;
};
struct environmental
{
	float EnvironmentalScore,AdjustedTemporal,AdjustedImpact ;
};

struct base calculate();
struct temporal calculate1();
struct environmental calculate2();
//fn defn of base
float AccessComplexity()
{
  char ac1;
  float AC;
  printf("Enter score of AccessComplexity\n");
  scanf("%s",&ac1);
  switch(ac1) {
    case 'h' :
        AC = 0.35;
               
        break;
    case 'm' :
        AC = 0.61;
               
        break;
    case 'l' :
        AC = 0.71;
        break;
    default :    
        printf("Please enter a valid CVSS Score\n");
    }
    return AC;
}
float Authentication() {
    char ac2;
    float Au;
    printf("Enter score of authentication\n");
    scanf(" %c", &ac2);
    switch(ac2) {
      case 'n' :
        Au = 0.704;
        break;   
      case 's' :
        Au = 0.56;
        break;
      case 'm' :
        Au = 0.45;
        break;
      default :
        printf("Please enter a valid CVSS Score\n");
   } 
   return Au;
}
float AccessVector() {
   char ac3;
   float AV;
   printf("Enter score of AccessVector\n");
   scanf(" %c",&ac3);
   switch(ac3) {
    case 'l' :
        AV = 0.395;
        break;
    case 'a' :
        AV = 0.646;
        break;
    case 'n' :
        AV = 1;
        break;
    default :
        printf("Please enter a valid CVSS Metric Score\n");
   }
    return AV;
}
float ConfidentialityImpact() {
   char ac4;
   float C;
  printf("Enter score of Confidentiality Impact\n");
  scanf(" %c", &ac4);
  switch(ac4) {
    case  'n' :
        C = 0.00;
        break;   
    case 'p' :
        C = 0.275;
        break;
    case  'c' :
        C = 0.660;
        break;
    default :
        printf("Please enter a valid CVSS Score\n");
   }
   return C;
}
float IntegrityImpact() {
  char ac5;
  float I;
  printf("Enter the score of Integrity Impact\n");
  scanf(" %c",&ac5);
  switch(ac5) {
    case 'n' :
        I = 0.00;
        break;
    case 'p' :
        I = 0.275;
         break;       
    case 'c' :
        I = 0.660;
        break;
    default :
        printf("Please enter a valid CVSS Score\n");
   }
   return I;  
}
float AvailabilityImpact() {
  char ac6;
  float A;
   printf("Enter the score of availability Impact\n");
  scanf(" %c", &ac6);
  switch(ac6) {
    case 'n' :
        A = 0.00;
        break;
    case 'p' :
        A = 0.275;
        break;
    case 'c' :
        A = 0.660;
        break;
    default :
        printf("Please enter a valid CVSS Score\n");
   }
   return A;
}
//CVSS Base Score Equations
struct base calculate() {
	float AC,Au,AV,C,I,A,fi;
	float Impact1;
	struct base store;
	AC=AccessComplexity();
	Au=Authentication();
	AV=AccessVector();
	C=ConfidentialityImpact();
	I=IntegrityImpact();
	A=AvailabilityImpact();
	store.CImp=C;
	store.IImp=I;
	store.AImp=A;
    store.Impact = 10.41 * (1 - (1 - C) * (1 - I) * (1 - A));

   if(store.Impact == 0) {
       fi = 0;
   } else {
       fi = 1.176;
   }
   store.Exploitability = 20 * AC * Au * AV;
   store.BaseScore = (0.6 * store.Impact + 0.4 * store.Exploitability - 1.5) * fi;
   printf("base\t%f/n",store.BaseScore);
   return store;
   
}
// fn defn of temporal
float Exploitability() {
char ex1;
float E;
printf("Enter score of Exploitability\n");
scanf(" %c",&ex1);
switch(ex1) {
    case 'u' :
        E = 0.85;
        break;
    case 'p' :
        E = 0.9;
        break;
    case 'f' :
        E = 0.95;
        break;
	case 'h' :
		E = 1.00;
		break;
	case 'n' :
		E = 1.00;
		break;
    default :    
        printf("please enter a valid CVSS Score");
    }
    return E;
}
float RemediationLevel() {

    char rl1;
    float RL;
    printf("Enter score of Remediation Level\n");
   scanf(" %c", &rl1);
   switch(rl1) {
    case 'o' :
        RL = 0.870;
        break;   
    case 't' :
        RL = 0.90;
        break;
    case 'w' :
        RL = 0.95;
		break;
	case 'u' :
		RL = 1.00;
		break;
	case 'n' : 
		RL = 1.00;
        break;
    default :
        printf("Please enter a valid CVSS Score\n");
   } 
   return RL;
}
float ReportConfidence() {
   char rc1;
   float RC;
   printf("Enter score of Report Confidence\n");
   scanf(" %c",&rc1);
   switch(rc1) {
    case 'f' :	//unconfirmed
        RC = 0.90;
        break;
    case 'u' : //uncorroborated
        RC = 0.95;
        break;
    case 'c' :
        RC = 1.00;
        break;
    case 'n' : //Not defined
		RC = 1.00;
		break;
    default :
        printf("Please enter a valid CVSS Metric Score\n");
   }
    return RC;
}	

struct temporal calculate1()
 {
	float E,RL,RC,R;
	struct base temp;// to find base score in temporal
	struct temporal store1;
	E=Exploitability();
	RL=RemediationLevel();
	RC=ReportConfidence();
	store1.ReLe=RL;
	store1.ReCo=RC;
	printf("Base \t%f\n",temp.BaseScore);
    store1.TemporalScore = temp.BaseScore * E*RL * RC;
    printf("TI%f\n",store1.TemporalScore);
    return store1;
}
// fn defn of environmental
float CollateralDamagePotential() {
char cdp1;
float CDP;
printf("Enter score of Collateral Damage Potential\n");
scanf(" %c",&cdp1);

switch(cdp1) {
    case 'n' :
        CDP = 0.0;
        break;
    case 'w' :	//low
        CDP = 0.1;  
        break;
    case 'l' :
        CDP = 0.3;
        break;
    case 'm' :	//low-medium
		CDP = 0.4;
		break;
	case 'h' :
		CDP = 0.5;
		break;
	case 'd' :	//not defined 
		CDP = 0;
    default :    
        printf("Please enter a valid CVSS Score\n");
    }
    return CDP;
}
float TargetDistribution() {
	char td1;
    float TD;
    printf("Enter score of TargetDistribution\n");
   scanf(" %c", &td1);
   switch(td1) {
    case 'n' :
        TD = 0.0;
        break;   
    case 'l' :
        TD = 0.25;
        break;
    case 'm' :
        TD = 0.75;
        break;
    case 'h' : 
		TD = 1.00;
		break;
	case 'd' :	//not defined
		TD = 1.00;
		break;
    default :
        printf("Please enter a valid CVSS Score\n");
   } 
   return TD;
}
float ConfidentialityRequirement() {
   char cr1;
   float CR;
   printf("Enter score of Confidentiality Requirement\n");
   scanf(" %c",&cr1);
   switch(cr1) {
    case 'l' :
        CR = 0.5;
        break;
    case 'm' :
        CR = 1.0;
        break;
    case 'h' :
        CR = 1.51;
        break;
	case 'n' :
		CR = 1.0;
		break;
    default :
        printf("Please enter a valid CVSS Metric Score\n");
   }
    return CR;
}
float IntegrityRequirement() {
   char ir1;
   float IR;
   printf("Enter score of Integrity Requirement\n");
   scanf(" %c",&ir1);
   switch(ir1) {
    case 'l' :
        IR = 0.5;
        break;
    case 'm' :
        IR = 1.0;
        break;
    case 'h' :
        IR = 1.51;
        break;
	case 'n' :
		IR = 1.0;
		break;
    default :
        printf("Please enter a valid CVSS Metric Score\n");
   }
    return IR;
}
float AvailabilityRequirement() {
   char ir1;
   float IR;
   printf("Enter score of Availability Requirement\n");
   scanf(" %c",&ir1);
   switch(ir1) {
    case 'l' :
        IR = 0.5;
        break;
    case 'm' :
        IR = 1.0;
        break;
    case 'h' :
        IR = 1.51;
        break;
	case 'n' :
		IR = 1.0;
		break;
    default :
        printf("Please enter a valid CVSS Metric Score\n");
   }
    return IR;
}

struct environmental calculate2()
{
	float CDP,TD,CR,IR,AR;
	struct environmental Store2;
	struct base temp1;//Exploitability,C,I,A from Base Score
	struct temporal temp2;// Remediation Level, Report confidence from temporal score
	CDP = CollateralDamagePotential();
	TD = TargetDistribution();
	CR = ConfidentialityRequirement();
	IR = IntegrityRequirement();
	AR = AvailabilityRequirement();
	
	float C,I,A;	
	C=temp1.CImp;
	I=temp1.IImp;
	A=temp1.AImp;
	float RL,RC,fi=1;
	
	RL=temp2.ReLe;
	RC=temp2.ReCo;
	float b;
	b=10.41 * (1 - (1 - C * CR) * (1 - I * IR) * (1 - A * AR));
	Store2.AdjustedImpact = 10<b?10:b;
    Store2.AdjustedTemporal = (0.6 * Store2.AdjustedImpact +.4 * temp1.Exploitability - 1.5) * fi * temp1.Exploitability * RL* RC;
    Store2.EnvironmentalScore = ((Store2.AdjustedTemporal + (10 -Store2.AdjustedTemporal)) * CDP) * TD;
    return Store2;
}

void main()
{
	struct base print;
	struct temporal print1;
	struct environmental print2;
	print=calculate();
	print1=calculate1();
	print2=calculate2();
	printf("Base Score=\t%f\n",print.BaseScore);
	printf("Exploitability in base score\t%f\n",print.Exploitability);
	printf("Impact\t%f\n",print.Impact);
	printf("Temporal Score\t%f\n",print1.TemporalScore);	
	printf("AdjustedImpact is %f\n",print2.AdjustedImpact); 
	printf("AdjustedTemporal is %f\n", print2.AdjustedTemporal);
	printf("Environmental Score is %f\n",print2.EnvironmentalScore); 
}

